## Предварительная подготовка

Анализ данных выполнялся с помощью языка программирования ruby и базы sqlite3. [БАЗА](football.db)

### Вспомогательные данные
Была создана БД с двумя таблицами: страны и матчи.
Страны:
```
sqlite> SELECT * FROM countries;
id|name
1|Египет
2|Марокко
3|Нигерия
```

матчи
```
left_country_id|right_country_id|date|time|info
19|22|07.07.2018|21:00|2 : 2 3 : 4
21|12|10.07.2018|21:00|1 : 0
22|11|11.07.2018|21:00|2 : 1 ДВ

```

## Обработка

### Разбить запросы по неделям

Скрипт [split_file.rb](split_file.rb) разбивал запросы по неделям, делил время запроса на дату и время, записывал результат в файл.

### Выделить околофутбольные запросы

Скрипт [main.rb](main.rb) выделял запросы на футбольную тематику.
Использовалось 2 фильтра: фильтр "футбольных" слов: ["чм", "чемпионат мира", "футбол"] и фильтр стран. Фильтр определял запросы с упоминанием стран-участниц вместе со специальными словами ["матч", "июня", "июл", "2018", "трансляция", "счет", "счёт", "сборн"] или упоминанием другой страны-участницы.

### Привязка ко времени матчей
С помощью скрипта [process_matches.rb](process_matches.rb) выполнялся анализ времени запроса. Для каждого запроса определялись все матчи дня. Затем производилась классификация запроса по четырем категориям:
- до начала первого матча дня
- во время матча
- между двумя матчами
- после последнего матча дня

Стоит отметить, что база данных матчей содержит только время начала матча. Для определения времени конца матча было сделано следующее предположение:
- Если счет содержит примечание "ДВ", значит победа была одержана в дополнительнео время. Значит время матча = время матча (90) + перерыв (15) + дополнительное время (30) = 135
- Если счет состоит из двух записей, значит была серия пенальти. Это 150 минут: 135 минут матча + 15 минут на серию пенальти
- В остальных случаях это обычный матч 105 минут.

Пример выходного файла: [запросы во время матча](files/during_match.csv)

### Подсчет частоты слов
Скрипт [word_stat.rb](word_stat.rb) в качестве аргумента принимает имя файла для обработки, например `ruby word_stat.rb before_match.csv`. Далее скрипт анализирует все слова всех запросов, исключая слова короче 3 символов и слова из списка ["чм", "2018", "июня", "июля"]. Результатом работы скрипта является список из 100 самых частых слов, для каждого слова указан процент использования

```
word,count,percentage
футболу,10849,10.02
мира,7007,6.47
чемпионат,5415,5.0
футбол,4124,3.81
египет,3265,3.02
уругвай,3142,2.9
расписание,2485,2.29
аргентина,2019,1.86
трансляция,1958,1.81
```

Результаты классификации:
- [популярные запросы до матча](files/stats_before_match.csv)
- [популярные запросы во время матча](files/stats_during_match.csv)
- [популярные запросы между матчами](files/stats_between_match.csv)
- [популярные запросы после матча](files/stats_after_match.csv)

